<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>ì£¼ë‹˜ì˜êµíšŒ ë‹¤ë½ë°© íšŒê³„ì•±</title>
    <style>
        /* ì „ì²´ ì´ˆê¸°í™” */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #f8f5f2 0%, #f0ede8 100%);
            line-height: 1.5;
            font-size: 16px;
            color: #3a3a3a;
            padding-bottom: 80px;
            min-height: 100vh;
        }

        /* ë¡œê·¸ì¸ í™”ë©´ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #e8d8c8 0%, #d4c4b4 100%);
        }

        .login-form {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        .login-form h1 {
            color: #6b5b4f;
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: 600;
            line-height: 1.4;
        }

        .login-form p {
            color: #8a7a6e;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .login-form input {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid #d4c4b4;
            border-radius: 12px;
            font-size: 18px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }

        .login-form input:focus {
            outline: none;
            border-color: #8a7a6e;
            background: white;
            box-shadow: 0 0 0 3px rgba(138, 122, 110, 0.1);
        }

        .login-form button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #a69080 0%, #8a7a6e 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 56px;
        }

        .login-form button:hover, .login-form button:active {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(138, 122, 110, 0.3);
        }

        /* ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ */
        .main-app {
            display: none;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #6b5b4f 0%, #8a7a6e 100%);
            color: white;
            padding: 20px 20px 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ì»¨í…Œì´ë„ˆ */
        .container {
            padding: 20px;
            max-width: 100%;
            margin: 0 auto;
        }

        /* ì„¹ì…˜ */
        .section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(212, 196, 180, 0.3);
        }

        .card h2 {
            color: #6b5b4f;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .card h3 {
            color: #6b5b4f;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        /* ì”ì•¡ ìš”ì•½ ì¹´ë“œ */
        .balance-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .balance-card {
            background: linear-gradient(135deg, #a69080 0%, #8a7a6e 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .balance-card h4 {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.9;
            font-weight: 500;
        }

        .balance-card .amount {
            font-size: 16px;
            font-weight: 700;
            line-height: 1.2;
        }

        /* í¼ ê·¸ë£¹ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #6b5b4f;
            font-size: 16px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #d4c4b4;
            border-radius: 12px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            min-height: 56px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #8a7a6e;
            background: white;
            box-shadow: 0 0 0 3px rgba(138, 122, 110, 0.1);
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            width: 100%;
            padding: 18px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            margin-bottom: 12px;
        }

        .btn:last-child {
            margin-bottom: 0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #a69080 0%, #8a7a6e 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #7a8471 0%, #6b7560 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #c4998a 0%, #b5897a 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #d4b5a0 0%, #c4a590 100%);
            color: white;
        }

        .btn:hover, .btn:active {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        /* ê±°ë˜ ë‚´ì—­ ìŠ¤íƒ€ì¼ */
        .transaction-list {
            margin-top: 20px;
        }

        .transaction-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid #d4c4b4;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .transaction-item.income {
            border-left-color: #7a8471;
        }

        .transaction-item.expense {
            border-left-color: #c4998a;
        }

        .transaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .transaction-date {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .transaction-type {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 20px;
            font-weight: 600;
        }

        .transaction-type.income {
            background: #e8f1e8;
            color: #5a6b5a;
        }

        .transaction-type.expense {
            background: #f1e8e8;
            color: #6b5a5a;
        }

        .transaction-info {
            margin-bottom: 8px;
        }

        .transaction-category {
            font-weight: 600;
            color: #6b5b4f;
            font-size: 16px;
        }

        .transaction-description {
            color: #666;
            font-size: 14px;
            margin-top: 4px;
        }

        .transaction-amounts {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 16px;
        }

        .transaction-amount.income {
            color: #5a6b5a;
        }

        .transaction-amount.expense {
            color: #6b5a5a;
        }

        .transaction-balance-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .transaction-balance {
            font-size: 14px;
            color: #666;
        }

        .delete-btn {
            background: #c4998a;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            min-height: 36px;
            min-width: 36px;
        }

        /* ì•Œë¦¼ */
        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.5;
        }

        .alert-warning {
            background: #f5f2f0;
            border: 2px solid #d4c4b4;
            color: #6b5b4f;
        }

        .alert-info {
            background: #f0f8ff;
            border: 2px solid #b3d9ff;
            color: #2c5aa0;
        }

        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid #e0e0e0;
            padding: 8px 0;
            z-index: 1000;
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            max-width: 500px;
            margin: 0 auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #666;
            min-height: 60px;
            justify-content: center;
        }

        .nav-item.active {
            color: #6b5b4f;
            background: rgba(107, 91, 79, 0.1);
            border-radius: 12px;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 600;
        }

        /* ëŒ€ì‹œë³´ë“œ í†µê³„ */
        .stats-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-item {
            margin-bottom: 12px;
        }

        .stats-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }

        .stats-value {
            font-size: 16px;
            font-weight: 600;
            color: #6b5b4f;
        }

        /* ë³´ê³ ì„œ ê´€ë ¨ */
        .report-table {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            overflow: hidden;
            margin-top: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .report-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .report-table th,
        .report-table td {
            padding: 12px 10px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }

        .report-table th {
            background: #f8f5f2;
            font-weight: 600;
            color: #6b5b4f;
        }

        /* ë³´ê³ ì„œ ìº¡ì²˜ ì˜ì—­ */
        .report-capture {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* ê¸°ê°„ ì¢…ë£Œ ì”ì•¡ ê¸ˆì•¡ í¬ê¸° ì¡°ì • */
        .final-balance {
            font-size: 13px !important;
        }

        /* ì„¤ì • í™”ë©´ */
        .settings-current {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .settings-current p {
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.6;
        }

        .settings-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .settings-actions .btn {
            flex: 1;
            margin-bottom: 0;
        }

        /* ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì„ ì„¤ì • ì¹´ë“œ ì•ˆì— ë°°ì¹˜ */
        .logout-section {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .logout-section h4 {
            color: #6b5b4f;
            margin-bottom: 10px;
            font-size: 16px;
        }

        /* ë³´ê³ ì„œ ê²°ê³¼ ìˆ¨ê¹€/í‘œì‹œ */
        .report-result {
            display: none;
        }

        .report-result.show {
            display: block;
        }

        /* ë°˜ì‘í˜• ì¡°ì • */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .balance-grid {
                grid-template-columns: 1fr;
            }
            
            .settings-actions {
                flex-direction: column;
                gap: 12px;
            }
            
            .settings-actions .btn {
                flex: none;
            }

            .nav-grid {
                grid-template-columns: repeat(5, 1fr);
            }

            .nav-icon {
                font-size: 18px;
            }

            .nav-label {
                font-size: 9px;
            }
        }

        /* ì ‘ê·¼ì„± ê°œì„  */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* í¬ì»¤ìŠ¤ ê°€ì‹œì„± */
        button:focus,
        input:focus,
        select:focus {
            outline: 2px solid #8a7a6e;
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginScreen" class="login-container">
        <div class="login-form">
            <h1>ì£¼ë‹˜ì˜êµíšŒ<br>ë‹¤ë½ë°© íšŒê³„ì•±</h1>
            <p>ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
            <input type="password" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" onkeypress="checkEnterKey(event)">
            <button onclick="login()">ë¡œê·¸ì¸</button>
            <p style="font-size: 14px; color: #999; margin-top: 20px;">
                ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸: 1234
            </p>
        </div>
    </div>

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
    <div id="mainApp" class="main-app">
        <!-- í—¤ë” -->
        <div class="header">
            <h1><span id="headerDarakbangName">ë‹¤ë½ë°©</span> íšŒê³„ì•±</h1>
            <p>í•¨ê»˜ ì§€ì–´ì ¸ê°€ëŠ” ì£¼ë‹˜ì˜êµíšŒ</p>
        </div>

        <div class="container">
            <!-- ì´ˆê¸°ì„¤ì • -->
            <div id="setup" class="section active">
                <div class="card">
                    <h2>ì´ˆê¸° ì„¤ì •</h2>
                    <div class="alert alert-warning">
                        <strong>ì¤‘ìš”!</strong> íšŒê³„ ì‹œì‘ ì „ì— ê¸°ë³¸ ì •ë³´ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.
                    </div>

                    <div id="setupForm">
                        <div class="form-group">
                            <label>ë‹¤ë½ë°© ì´ë¦„</label>
                            <input type="text" id="setupDarakbangName" placeholder="ë‹¤ë½ë°© ì´ë¦„ ì…ë ¥">
                        </div>
                        <div class="form-group">
                            <label>íšŒê³„ ì‹œì‘ì¼</label>
                            <input type="date" id="setupBaseDate">
                        </div>
                        <div class="form-group">
                            <label>ì´ì›” ì”ê³  (ì›)</label>
                            <input type="number" id="carryOverInput" placeholder="50000" value="50000">
                        </div>
                        <div class="form-group">
                            <label>ë‹´ë‹¹ì ì´ë¦„</label>
                            <input type="text" id="managerName" placeholder="ë‹´ë‹¹ì ì´ë¦„ ì…ë ¥">
                        </div>
                        <div class="form-group">
                            <label>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ì„ íƒ)</label>
                            <input type="password" id="newPassword" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ê¸°ë³¸: 1234)">
                        </div>
                        <button onclick="saveInitialSettings()" class="btn btn-success">ì„¤ì • ì €ì¥</button>
                    </div>

                    <div id="currentSettings" class="settings-current" style="display: none;">
                        <h3>í˜„ì¬ ì„¤ì •</h3>
                        <p><strong>ë‹¤ë½ë°©:</strong> <span id="currentDarakbangName">-</span></p>
                        <p><strong>ì‹œì‘ì¼:</strong> <span id="currentBaseDate">-</span></p>
                        <p><strong>ì´ì›”ì”ê³ :</strong> <span id="currentCarryOver">-</span></p>
                        <p><strong>ë‹´ë‹¹ì:</strong> <span id="currentManager">-</span></p>

                        <div class="alert alert-warning" style="margin-top: 20px;">
                            <strong>ì£¼ì˜!</strong> ì´ˆê¸°í™”í•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.
                        </div>

                        <div class="settings-actions">
                            <button onclick="editSettings()" class="btn btn-warning">ì„¤ì • ìˆ˜ì •</button>
                            <button onclick="resetAllData()" class="btn btn-danger">ì „ì²´ ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                </div>

                <!-- ë¡œê·¸ì•„ì›ƒ ì„¹ì…˜ì„ ì„¤ì • í˜ì´ì§€ì— ë°°ì¹˜ -->
                <div class="logout-section">
                    <h4>ê³„ì • ê´€ë¦¬</h4>
                    <button onclick="logout()" class="btn btn-warning">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>

            <!-- ëŒ€ì‹œë³´ë“œ -->
            <div id="dashboard" class="section">
                <div class="balance-grid">
                    <div class="balance-card">
                        <h4>ì´ì›” ì”ê³ </h4>
                        <div class="amount" id="carryOverBalance">0ì›</div>
                    </div>
                    <div class="balance-card">
                        <h4>í˜„ì¬ ì”ì•¡</h4>
                        <div class="amount" id="currentBalance">0ì›</div>
                    </div>
                    <div class="balance-card">
                        <h4>ì´ ì…ê¸ˆ</h4>
                        <div class="amount" id="totalIncome">0ì›</div>
                    </div>
                    <div class="balance-card">
                        <h4>ì´ ì¶œê¸ˆ</h4>
                        <div class="amount" id="totalExpense">0ì›</div>
                    </div>
                </div>

                <div class="stats-card">
                    <div class="stats-item">
                        <div class="stats-label">ë‹¤ë½ë°© ì´ë¦„</div>
                        <div class="stats-value" id="dashboardDarakbangName">-</div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-label">ê±°ë˜ ê±´ìˆ˜</div>
                        <div class="stats-value" id="transactionCount">0ê±´</div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-label">ìµœê·¼ ê±°ë˜ì¼</div>
                        <div class="stats-value" id="lastTransactionDate">-</div>
                    </div>
                </div>
            </div>

            <!-- ì…ì¶œê¸ˆ ë“±ë¡ -->
            <div id="transaction" class="section">
                <div class="card">
                    <h2>ì…ê¸ˆ ë“±ë¡</h2>
                    <div class="form-group">
                        <label>ë‚ ì§œ</label>
                        <input type="date" id="incomeDate">
                    </div>
                    <div class="form-group">
                        <label>ì…ê¸ˆì•¡</label>
                        <input type="number" id="incomeAmount" placeholder="ê¸ˆì•¡ ì…ë ¥">
                    </div>
                    <div class="form-group">
                        <label>ì…ê¸ˆ ë‚´ì—­</label>
                        <select id="incomeCategory">
                            <option value="ë‹¤ë½ë°© í—Œê¸ˆ">ë‹¤ë½ë°© í—Œê¸ˆ</option>
                            <option value="ëª¨ì„ë¹„">ëª¨ì„ë¹„</option>
                            <option value="í›„ì›ê¸ˆ">í›„ì›ê¸ˆ</option>
                            <option value="ì´ììˆ˜ì…">ì´ììˆ˜ì…</option>
                            <option value="ê¸°íƒ€ìˆ˜ì…">ê¸°íƒ€ìˆ˜ì…</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ìƒì„¸ ë‚´ìš©</label>
                        <input type="text" id="incomeDescription" placeholder="ìƒì„¸ ë‚´ìš© (ì„ íƒ)">
                    </div>
                    <button onclick="addTransaction('income')" class="btn btn-success">ì…ê¸ˆ ë“±ë¡</button>
                </div>

                <div class="card">
                    <h2>ì¶œê¸ˆ ë“±ë¡</h2>
                    <div class="form-group">
                        <label>ë‚ ì§œ</label>
                        <input type="date" id="expenseDate">
                    </div>
                    <div class="form-group">
                        <label>ì¶œê¸ˆì•¡</label>
                        <input type="number" id="expenseAmount" placeholder="ê¸ˆì•¡ ì…ë ¥">
                    </div>
                    <div class="form-group">
                        <label>ì¶œê¸ˆ ë‚´ì—­</label>
                        <select id="expenseCategory">
                            <option value="ë‹¤ë½ë°© í—Œê¸ˆ">ë‹¤ë½ë°© í—Œê¸ˆ</option>
                            <option value="ì‹ì‚¬ë¹„">ì‹ì‚¬ë¹„</option>
                            <option value="ì—´ë¦° ë‹¤ë½ë°© ëª¨ì„ë¹„">ì—´ë¦° ë‹¤ë½ë°© ëª¨ì„ë¹„</option>
                            <option value="ì„ ë¬¼ë¹„">ì„ ë¬¼ë¹„</option>
                            <option value="í–‰ì‚¬ë¹„">í–‰ì‚¬ë¹„</option>
                            <option value="ê¸°íƒ€ì§€ì¶œ">ê¸°íƒ€ì§€ì¶œ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ìƒì„¸ ë‚´ìš©</label>
                        <input type="text" id="expenseDescription" placeholder="ìƒì„¸ ë‚´ìš© (ì„ íƒ)">
                    </div>
                    <button onclick="addTransaction('expense')" class="btn btn-danger">ì¶œê¸ˆ ë“±ë¡</button>
                </div>
            </div>

            <!-- ê±°ë˜ ë‚´ì—­ -->
            <div id="history" class="section">
                <div class="card">
                    <h2>ê±°ë˜ ë‚´ì—­</h2>
                    <div class="transaction-list" id="transactionHistory">
                        <!-- ê±°ë˜ ë‚´ì—­ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>

            <!-- ë³´ê³ ì„œ -->
            <div id="report" class="section">
                <div class="card">
                    <h2>íšŒê³„ ë³´ê³ ì„œ</h2>
                    
                    <div class="alert alert-info">
                        <strong>ì•ˆë‚´:</strong> ê¸°ê°„ì„ ì„ íƒí•˜ê³  ë³´ê³ ì„œ ìƒì„± ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”. ê¸°ê°„ì„ ì„ íƒí•˜ì§€ ì•Šìœ¼ë©´ ì „ì²´ ê¸°ê°„ ë³´ê³ ì„œê°€ ìƒì„±ë©ë‹ˆë‹¤.
                    </div>
                    
                    <div class="form-group">
                        <label>ì‹œì‘ ë‚ ì§œ</label>
                        <input type="date" id="reportStartDate">
                    </div>
                    <div class="form-group">
                        <label>ì¢…ë£Œ ë‚ ì§œ</label>
                        <input type="date" id="reportEndDate">
                    </div>
                    <button onclick="generateReport()" class="btn btn-primary">ë³´ê³ ì„œ ìƒì„±</button>
                </div>

                <!-- ë³´ê³ ì„œ ê²°ê³¼ ì˜ì—­ -->
                <div class="report-result" id="reportResult">
                    <!-- ë³´ê³ ì„œ ìº¡ì²˜ ì˜ì—­ -->
                    <div class="report-capture" id="reportCapture">
                        <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 20px;">
                            <h3 style="color: #6b5b4f; margin-bottom: 10px;">íšŒê³„ ë³´ê³ ì„œ</h3>
                            <p><strong>ë‹¤ë½ë°©:</strong> <span id="reportDarakbangName">-</span></p>
                            <p><strong>ë³´ê³ ì„œ ê¸°ê°„:</strong> <span id="reportPeriod">ì „ì²´</span></p>
                            <p><strong>ë‹´ë‹¹ì:</strong> <span id="reportManager">-</span></p>
                            <p><strong>ì‘ì„±ì¼:</strong> <span id="reportDate">-</span></p>
                        </div>

                        <div class="report-table">
                            <table id="consolidatedReport">
                                <thead>
                                    <tr>
                                        <th>í•­ëª©</th>
                                        <th style="text-align: right;">ê¸ˆì•¡</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <button onclick="captureReport()" class="btn btn-success">ë³´ê³ ì„œ ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="bottom-nav">
            <div class="nav-grid">
                <div class="nav-item active" onclick="showSection('setup')">
                    <div class="nav-icon">âš™ï¸</div>
                    <div class="nav-label">ì„¤ì •</div>
                </div>
                <div class="nav-item" onclick="showSection('dashboard')">
                    <div class="nav-icon">ğŸ“Š</div>
                    <div class="nav-label">ëŒ€ì‹œë³´ë“œ</div>
                </div>
                <div class="nav-item" onclick="showSection('transaction')">
                    <div class="nav-icon">ğŸ’°</div>
                    <div class="nav-label">ì…ì¶œê¸ˆ</div>
                </div>
                <div class="nav-item" onclick="showSection('history')">
                    <div class="nav-icon">ğŸ“‹</div>
                    <div class="nav-label">ë‚´ì—­</div>
                </div>
                <div class="nav-item" onclick="showSection('report')">
                    <div class="nav-icon">ğŸ“„</div>
                    <div class="nav-label">ë³´ê³ ì„œ</div>
                </div>
            </div>
        </div>
    </div>

    <!-- HTML2Canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let transactions = [];
        let currentPassword = '1234';
        let settings = {
            darakbangName: '',
            baseDate: '',
            carryOverBalance: 0,
            managerName: '',
            isSetup: false
        };

        // ë°ì´í„° ì €ì¥/ë¡œë“œ
        function saveData() {
            try {
                const data = {
                    transactions: transactions,
                    settings: settings,
                    currentPassword: currentPassword,
                    lastSaved: new Date().toISOString()
                };
                localStorage.setItem('darakbang-accounting-data', JSON.stringify(data));
            } catch (error) {
                console.error('ë°ì´í„° ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('darakbang-accounting-data');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    transactions = data.transactions || [];
                    settings = data.settings || {
                        darakbangName: '',
                        baseDate: '',
                        carryOverBalance: 0,
                        managerName: '',
                        isSetup: false
                    };
                    currentPassword = data.currentPassword || '1234';
                    return true;
                }
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
            return false;
        }

        // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
        function checkEnterKey(event) {
            if (event.key === 'Enter') {
                login();
            }
        }

        function login() {
            const password = document.getElementById('passwordInput').value;
            if (password === currentPassword) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                loadSettings();
                setTodayAsDefault();
                updateAllDisplays();
                updateHeaderDarakbangName();
                // ë¡œê·¸ì¸ ì‹œì—ëŠ” ë³´ê³ ì„œë¥¼ ìë™ ìƒì„±í•˜ì§€ ì•ŠìŒ
            } else {
                showAlert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                document.getElementById('passwordInput').value = '';
            }
        }

        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('passwordInput').value = '';
            }
        }

        // ì´ˆê¸°í™”
        window.onload = function() {
            loadData();
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        };

        function setTodayAsDefault() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('setupBaseDate').value = today;
            document.getElementById('incomeDate').value = today;
            document.getElementById('expenseDate').value = today;
        }

        // ì„¤ì • ê´€ë ¨
        function updateHeaderDarakbangName() {
            const headerElement = document.getElementById('headerDarakbangName');
            if (settings.darakbangName) {
                headerElement.textContent = `${settings.darakbangName} ë‹¤ë½ë°©`;
            } else {
                headerElement.textContent = 'ë‹¤ë½ë°©';
            }
        }

        function saveInitialSettings() {
            const darakbangName = document.getElementById('setupDarakbangName').value.trim();
            const baseDate = document.getElementById('setupBaseDate').value;
            const carryOver = parseInt(document.getElementById('carryOverInput').value) || 0;
            const manager = document.getElementById('managerName').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();

            if (!darakbangName) {
                showAlert('ë‹¤ë½ë°© ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!baseDate) {
                showAlert('íšŒê³„ ì‹œì‘ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!manager) {
                showAlert('ë‹´ë‹¹ì ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            settings = {
                darakbangName: darakbangName,
                baseDate: baseDate,
                carryOverBalance: carryOver,
                managerName: manager,
                isSetup: true
            };

            if (newPassword) {
                currentPassword = newPassword;
            }

            updateSettingsDisplay();
            updateAllDisplays();
            updateHeaderDarakbangName();
            saveData();
            showAlert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            document.getElementById('newPassword').value = '';
        }

        function updateSettingsDisplay() {
            if (settings.isSetup) {
                document.getElementById('setupForm').style.display = 'none';
                document.getElementById('currentSettings').style.display = 'block';
                document.getElementById('currentDarakbangName').textContent = settings.darakbangName;
                document.getElementById('currentBaseDate').textContent = settings.baseDate;
                document.getElementById('currentCarryOver').textContent = settings.carryOverBalance.toLocaleString() + 'ì›';
                document.getElementById('currentManager').textContent = settings.managerName;
            } else {
                document.getElementById('setupForm').style.display = 'block';
                document.getElementById('currentSettings').style.display = 'none';
            }
        }

        function editSettings() {
            if (confirm('ì„¤ì •ì„ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('setupDarakbangName').value = settings.darakbangName;
                document.getElementById('setupBaseDate').value = settings.baseDate;
                document.getElementById('carryOverInput').value = settings.carryOverBalance;
                document.getElementById('managerName').value = settings.managerName;
                document.getElementById('setupForm').style.display = 'block';
                document.getElementById('currentSettings').style.display = 'none';
            }
        }

        function resetAllData() {
            const confirmText = `ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œë˜ëŠ” ë°ì´í„°:\nâ€¢ ì„¤ì • ì •ë³´\nâ€¢ ê±°ë˜ ë‚´ì—­ (${transactions.length}ê±´)\nâ€¢ ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”`;
            
            if (confirm(confirmText)) {
                const finalConfirm = prompt('ì •ë§ë¡œ ì´ˆê¸°í™”í•˜ë ¤ë©´ "ì´ˆê¸°í™”"ë¥¼ ì…ë ¥í•˜ì„¸ìš”:', '');
                if (finalConfirm === 'ì´ˆê¸°í™”') {
                    transactions = [];
                    currentPassword = '1234';
                    settings = {
                        darakbangName: '',
                        baseDate: '',
                        carryOverBalance: 0,
                        managerName: '',
                        isSetup: false
                    };
                    
                    document.getElementById('setupDarakbangName').value = '';
                    document.getElementById('setupBaseDate').value = '';
                    document.getElementById('carryOverInput').value = '50000';
                    document.getElementById('managerName').value = '';
                    document.getElementById('newPassword').value = '';
                    
                    document.getElementById('setupForm').style.display = 'block';
                    document.getElementById('currentSettings').style.display = 'none';
                    
                    // ë³´ê³ ì„œ ê²°ê³¼ ìˆ¨ê¸°ê¸°
                    document.getElementById('reportResult').classList.remove('show');
                    
                    setTodayAsDefault();
                    updateAllDisplays();
                    updateHeaderDarakbangName();
                    saveData();
                    showAlert('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        function loadSettings() {
            updateSettingsDisplay();
        }

        // ì„¹ì…˜ ì „í™˜ (ìˆ˜ì •ë¨: ë³´ê³ ì„œ ìë™ ìƒì„± ì œê±°)
        function showSection(sectionName) {
            if (!settings.isSetup && sectionName !== 'setup') {
                showAlert('ë¨¼ì € ì´ˆê¸° ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.remove('active'));

            // ëª¨ë“  ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ë¹„í™œì„±í™”
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));

            // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
            document.getElementById(sectionName).classList.add('active');
            
            // í•´ë‹¹ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í™œì„±í™”
            const activeNavItem = Array.from(navItems).find(item => 
                item.onclick.toString().includes(`showSection('${sectionName}')`)
            );
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }

            // ë³´ê³ ì„œ ì„¹ì…˜ì¼ ë•Œ ë³´ê³ ì„œ ê²°ê³¼ ìˆ¨ê¸°ê¸°
            if (sectionName === 'report') {
                document.getElementById('reportResult').classList.remove('show');
            }
        }

        // ê±°ë˜ ë“±ë¡
        function addTransaction(type) {
            if (!settings.isSetup) {
                showAlert('ë¨¼ì € ì´ˆê¸° ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                return;
            }

            let amount, category, description, date;

            if (type === 'income') {
                date = document.getElementById('incomeDate').value;
                amount = parseInt(document.getElementById('incomeAmount').value);
                category = document.getElementById('incomeCategory').value;
                description = document.getElementById('incomeDescription').value;

                if (!date) {
                    showAlert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (!amount || amount <= 0) {
                    showAlert('ì˜¬ë°”ë¥¸ ì…ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                document.getElementById('incomeAmount').value = '';
                document.getElementById('incomeDescription').value = '';
            } else {
                date = document.getElementById('expenseDate').value;
                amount = parseInt(document.getElementById('expenseAmount').value);
                category = document.getElementById('expenseCategory').value;
                description = document.getElementById('expenseDescription').value;

                if (!date) {
                    showAlert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (!amount || amount <= 0) {
                    showAlert('ì˜¬ë°”ë¥¸ ì¶œê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                document.getElementById('expenseAmount').value = '';
                document.getElementById('expenseDescription').value = '';
            }

            const currentBalance = getCurrentBalance();
            const newBalance = type === 'income' ? currentBalance + amount : currentBalance - amount;

            const transaction = {
                id: Date.now(),
                dateTime: new Date().toLocaleString('ko-KR', {
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
                }),
                date: date,
                type: type,
                category: category,
                description: description || '',
                amount: amount,
                balance: newBalance
            };

            transactions.push(transaction);
            updateAllDisplays();
            saveData();
            showAlert(type === 'income' ? 'ì…ê¸ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!' : 'ì¶œê¸ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ê±°ë˜ ì‚­ì œ
        function deleteTransaction(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (transaction && confirm(`${transaction.category} ê±°ë˜(${transaction.amount.toLocaleString()}ì›)ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const index = transactions.findIndex(t => t.id === transactionId);
                transactions.splice(index, 1);
                recalculateBalances();
                updateAllDisplays();
                saveData();
                showAlert('ê±°ë˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì”ì•¡ ì¬ê³„ì‚°
        function recalculateBalances() {
            let currentBalance = settings.carryOverBalance;
            transactions.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));
            
            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    currentBalance += transaction.amount;
                } else {
                    currentBalance -= transaction.amount;
                }
                transaction.balance = currentBalance;
            });
        }

        function getCurrentBalance() {
            let balance = settings.carryOverBalance;
            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    balance += transaction.amount;
                } else {
                    balance -= transaction.amount;
                }
            });
            return balance;
        }

        // í™”ë©´ ì—…ë°ì´íŠ¸
        function updateAllDisplays() {
            updateDashboard();
            updateTransactionHistory();
        }

        function updateDashboard() {
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const currentBalance = getCurrentBalance();

            document.getElementById('carryOverBalance').textContent = settings.carryOverBalance.toLocaleString() + 'ì›';
            document.getElementById('totalIncome').textContent = totalIncome.toLocaleString() + 'ì›';
            document.getElementById('totalExpense').textContent = totalExpense.toLocaleString() + 'ì›';
            document.getElementById('currentBalance').textContent = currentBalance.toLocaleString() + 'ì›';
            document.getElementById('transactionCount').textContent = transactions.length + 'ê±´';

            if (transactions.length > 0) {
                document.getElementById('lastTransactionDate').textContent = new Date(transactions[transactions.length - 1].date).toLocaleDateString('ko-KR');
            } else {
                document.getElementById('lastTransactionDate').textContent = '-';
            }

            document.getElementById('dashboardDarakbangName').textContent = settings.darakbangName || '-';
        }

        function updateTransactionHistory() {
            const container = document.getElementById('transactionHistory');
            let allTransactions = [...transactions];

            if (allTransactions.length === 0 && !settings.isSetup) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ë“±ë¡ëœ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            container.innerHTML = '';

            // ì´ì›” ì”ê³  í•­ëª©ì„ ë¨¼ì € ì¶”ê°€ (ë§¨ ìœ„ì—)
            if (settings.isSetup) {
                const carryOverItem = document.createElement('div');
                carryOverItem.className = 'transaction-item';
                carryOverItem.innerHTML = `
                    <div class="transaction-header">
                        <div class="transaction-date">${settings.baseDate || '-'}</div>
                        <div class="transaction-type">ì´ì›”</div>
                    </div>
                    <div class="transaction-info">
                        <div class="transaction-category">ì´ì›” ì”ê³ </div>
                    </div>
                    <div class="transaction-amounts">
                        <div class="transaction-amount income">+${settings.carryOverBalance.toLocaleString()}ì›</div>
                        <div class="transaction-balance">ì”ì•¡: ${settings.carryOverBalance.toLocaleString()}ì›</div>
                    </div>
                `;
                container.appendChild(carryOverItem);
            }

            // ì‹œê°„ìˆœ ì •ë ¬ (ì˜¤ë˜ëœ ìˆœì„œë¶€í„° = ìµœì‹ ì´ ì•„ë˜ë¡œ)
            allTransactions.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));

            allTransactions.forEach(transaction => {
                const item = document.createElement('div');
                item.className = `transaction-item ${transaction.type}`;
                
                item.innerHTML = `
                    <div class="transaction-header">
                        <div class="transaction-date">${transaction.date}</div>
                        <div class="transaction-type ${transaction.type}">
                            ${transaction.type === 'income' ? 'ì…ê¸ˆ' : 'ì¶œê¸ˆ'}
                        </div>
                    </div>
                    <div class="transaction-info">
                        <div class="transaction-category">${transaction.category}</div>
                        ${transaction.description ? `<div class="transaction-description">${transaction.description}</div>` : ''}
                    </div>
                    <div class="transaction-amounts">
                        <div class="transaction-amount ${transaction.type}">
                            ${transaction.type === 'income' ? '+' : '-'}${transaction.amount.toLocaleString()}ì›
                        </div>
                        <div class="transaction-balance-row">
                            <div class="transaction-balance">ì”ì•¡: ${transaction.balance.toLocaleString()}ì›</div>
                            <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // ë³´ê³ ì„œ ìƒì„± (ìˆ˜ì •ë¨: ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ ì‹¤í–‰)
        function generateReport() {
            if (!settings.isSetup) {
                showAlert('ë¨¼ì € ì´ˆê¸° ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                return;
            }

            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;

            let filteredTransactions = transactions;

            // ë‚ ì§œ í•„í„°ë§ ë¡œì§ ìˆ˜ì •
            if (startDate && endDate) {
                filteredTransactions = transactions.filter(transaction => {
                    const transactionDate = transaction.date;
                    return transactionDate >= startDate && transactionDate <= endDate;
                });
            } else if (startDate) {
                filteredTransactions = transactions.filter(transaction => {
                    return transaction.date >= startDate;
                });
            } else if (endDate) {
                filteredTransactions = transactions.filter(transaction => {
                    return transaction.date <= endDate;
                });
            }

            let periodStartBalance = settings.carryOverBalance;
            if (startDate) {
                const beforeStartTransactions = transactions.filter(transaction => {
                    return transaction.date < startDate;
                });
                beforeStartTransactions.forEach(transaction => {
                    if (transaction.type === 'income') {
                        periodStartBalance += transaction.amount;
                    } else {
                        periodStartBalance -= transaction.amount;
                    }
                });
            }

            const totalIncomeInPeriod = filteredTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpenseInPeriod = filteredTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const periodEndBalance = periodStartBalance + totalIncomeInPeriod - totalExpenseInPeriod;

            // ì¹´í…Œê³ ë¦¬ë³„ ì§‘ê³„ - ëª¨ë“  ì¹´í…Œê³ ë¦¬ í‘œì‹œ
            const incomeByCategory = {
                'ë‹¤ë½ë°© í—Œê¸ˆ': 0, 'ëª¨ì„ë¹„': 0, 'í›„ì›ê¸ˆ': 0, 'ì´ììˆ˜ì…': 0, 'ê¸°íƒ€ìˆ˜ì…': 0
            };

            const expenseByCategory = {
                'ë‹¤ë½ë°© í—Œê¸ˆ': 0, 'ì‹ì‚¬ë¹„': 0, 'ì—´ë¦° ë‹¤ë½ë°© ëª¨ì„ë¹„': 0, 'ì„ ë¬¼ë¹„': 0, 'í–‰ì‚¬ë¹„': 0, 'ê¸°íƒ€ì§€ì¶œ': 0
            };

            filteredTransactions.forEach(transaction => {
                if (transaction.type === 'income' && incomeByCategory.hasOwnProperty(transaction.category)) {
                    incomeByCategory[transaction.category] += transaction.amount;
                } else if (transaction.type === 'expense' && expenseByCategory.hasOwnProperty(transaction.category)) {
                    expenseByCategory[transaction.category] += transaction.amount;
                }
            });

            document.getElementById('reportDate').textContent = new Date().toLocaleDateString('ko-KR');
            document.getElementById('reportDarakbangName').textContent = settings.darakbangName || '-';
            document.getElementById('reportManager').textContent = settings.managerName || '-';

            let periodText = 'ì „ì²´';
            if (startDate && endDate) {
                periodText = `${startDate} ~ ${endDate}`;
            } else if (startDate) {
                periodText = `${startDate} ì´í›„`;
            } else if (endDate) {
                periodText = `${endDate} ì´ì „`;
            }
            document.getElementById('reportPeriod').textContent = periodText;

            const tbody = document.querySelector('#consolidatedReport tbody');
            tbody.innerHTML = '';

            // ìˆ˜ì… ë‚´ì—­ ìš”ì•½
            tbody.innerHTML += `<tr style="background: #f8f5f2;"><td colspan="2"><strong>ìˆ˜ì… ë‚´ì—­ ìš”ì•½</strong></td></tr>`;
            tbody.innerHTML += `<tr><td>ì´ì›” ì”ê³ </td><td style="text-align: right;">${periodStartBalance.toLocaleString()}ì›</td></tr>`;
            
            // ëª¨ë“  ìˆ˜ì… ì¹´í…Œê³ ë¦¬ í‘œì‹œ (0ì›ë„ í‘œì‹œ)
            for (const category in incomeByCategory) {
                tbody.innerHTML += `<tr><td>${category}</td><td style="color: #5a6b5a; font-weight: 600; text-align: right;">${incomeByCategory[category].toLocaleString()}ì›</td></tr>`;
            }
            tbody.innerHTML += `<tr style="background: #e8f5e8;"><td><strong>ì´ ìˆ˜ì…</strong></td><td style="color: #5a6b5a; font-weight: 700; text-align: right;"><strong>${(periodStartBalance + totalIncomeInPeriod).toLocaleString()}ì›</strong></td></tr>`;

            // ì§€ì¶œ ë‚´ì—­ ìš”ì•½
            tbody.innerHTML += `<tr style="background: #f8f5f2;"><td colspan="2"><strong>ì§€ì¶œ ë‚´ì—­ ìš”ì•½</strong></td></tr>`;
            
            // ëª¨ë“  ì§€ì¶œ ì¹´í…Œê³ ë¦¬ í‘œì‹œ (0ì›ë„ í‘œì‹œ)
            for (const category in expenseByCategory) {
                tbody.innerHTML += `<tr><td>${category}</td><td style="color: #6b5a5a; font-weight: 600; text-align: right;">${expenseByCategory[category].toLocaleString()}ì›</td></tr>`;
            }
            tbody.innerHTML += `<tr style="background: #f5e8e8;"><td><strong>ì´ ì§€ì¶œ</strong></td><td style="color: #6b5a5a; font-weight: 700; text-align: right;"><strong>${totalExpenseInPeriod.toLocaleString()}ì›</strong></td></tr>`;

            // ìµœì¢… ê²°ì‚°
            tbody.innerHTML += `<tr style="background: #f0f0f0;"><td colspan="2"><strong>ìµœì¢… ê²°ì‚°</strong></td></tr>`;
            tbody.innerHTML += `<tr><td>ê¸°ê°„ ì‹œì‘ ì”ì•¡</td><td style="text-align: right;">${periodStartBalance.toLocaleString()}ì›</td></tr>`;
            tbody.innerHTML += `<tr><td>ì´ ìˆ˜ì…</td><td style="color: #5a6b5a; text-align: right;">+${totalIncomeInPeriod.toLocaleString()}ì›</td></tr>`;
            tbody.innerHTML += `<tr><td>ì´ ì§€ì¶œ</td><td style="color: #6b5a5a; text-align: right;">-${totalExpenseInPeriod.toLocaleString()}ì›</td></tr>`;
            tbody.innerHTML += `<tr style="background: #e0e0e0; font-weight: 700;"><td><strong>ê¸°ê°„ ì¢…ë£Œ ì”ì•¡</strong></td><td style="text-align: right;"><strong class="final-balance">${periodEndBalance.toLocaleString()}ì›</strong></td></tr>`;

            // ë³´ê³ ì„œ ê²°ê³¼ í‘œì‹œ
            document.getElementById('reportResult').classList.add('show');
            showAlert('ë³´ê³ ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ë³´ê³ ì„œ ì´ë¯¸ì§€ ìº¡ì²˜ ë° ì €ì¥
        function captureReport() {
            if (!window.html2canvas) {
                showAlert('ì´ë¯¸ì§€ ì €ì¥ ê¸°ëŠ¥ì„ ë¡œë“œí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            const captureElement = document.getElementById('reportCapture');
            
            showAlert('ë³´ê³ ì„œë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤...');
            
            html2canvas(captureElement, {
                backgroundColor: '#ffffff',
                scale: 2,
                useCORS: true,
                allowTaint: true
            }).then(function(canvas) {
                // ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•œ ë§í¬ë¡œ ë³€í™˜
                const link = document.createElement('a');
                link.download = `ë‹¤ë½ë°©_íšŒê³„ë³´ê³ ì„œ_${new Date().toISOString().split('T')[0]}.png`;
                link.href = canvas.toDataURL();
                
                // ìë™ ë‹¤ìš´ë¡œë“œ ì‹¤í–‰
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showAlert('ë³´ê³ ì„œ ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(function(error) {
                console.error('ì´ë¯¸ì§€ ì €ì¥ ì˜¤ë¥˜:', error);
                showAlert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(message) {
            alert(message);
        }
    </script>
</body>
</html>
