<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>파주직장1여 다락방 회계장부</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f2f0 0%, #e8e4e0 50%, #f0efec 100%);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* 로그인 화면 스타일 */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #d4b5a0 0%, #c8a48a 25%, #a68b7a 50%, #8b7a6b 75%, #c8b5a4 100%);
        }
        
        .login-form {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(139, 122, 107, 0.2);
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(212, 181, 160, 0.3);
        }
        
        .login-form h1 {
            color: #8b7a6b;
            margin-bottom: 10px;
            font-size: 1.8em;
        }
        
        .login-form p {
            color: #a68b7a;
            margin-bottom: 30px;
        }
        
        .login-form input {
            width: 100%;
            padding: 15px;
            border: 2px solid #d4b5a0;
            border-radius: 25px;
            font-size: 16px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        .login-form input:focus {
            outline: none;
            border-color: #8b7a6b;
            background: white;
            transform: scale(1.02);
        }
        
        .login-form button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #c8a48a 0%, #d4b5a0 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .login-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(200, 164, 138, 0.4);
        }
        
        /* 메인 애플리케이션 스타일 */
        .main-app {
            display: none;
        }
        
        header {
            background: linear-gradient(135deg, #8b7a6b 0%, #a68b7a 50%, #7d8471 100%);
            color: white;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(139, 122, 107, 0.3);
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }
        
        header h1 {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 5px;
        }
        
        header p {
            opacity: 0.9;
        }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: white;
            color: #8b7a6b;
        }
        
        nav {
            background: linear-gradient(135deg, #b5c2a8 0%, #a8b59c 50%, #9ca892 100%);
            padding: 15px;
            text-align: center;
            overflow-x: auto;
            white-space: nowrap;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        nav button {
            background: linear-gradient(135deg, #d4d8ce 0%, #c8ccc2 100%);
            color: #5a5a5a;
            border: 2px solid rgba(255, 255, 255, 0.6);
            padding: 12px 20px;
            margin: 0 5px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            min-height: 44px;
            display: inline-block;
            font-weight: 500;
        }
        
        nav button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 216, 206, 0.4);
        }
        
        nav button.active {
            background: linear-gradient(135deg, #8b7a6b 0%, #a68b7a 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(139, 122, 107, 0.3);
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.95);
            margin: 20px 0;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(139, 122, 107, 0.1);
            display: none;
            border: 2px solid rgba(212, 181, 160, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .section.active {
            display: block;
        }
        
        .setup-section {
            background: linear-gradient(135deg, #f5f2f0 0%, #e8e4e0 100%);
            border: 3px solid #d4b5a0;
        }
        
        .balance-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .balance-card {
            background: linear-gradient(135deg, #9ca892 0%, #a8b59c 100%);
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(156, 168, 146, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .balance-card h3 {
            margin-bottom: 10px;
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .balance-card .amount {
            font-size: 1.8em;
            font-weight: bold;
            color: white;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #8b7a6b;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #d4b5a0;
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #8b7a6b;
            background: white;
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(139, 122, 107, 0.2);
        }
        
        .btn {
            background: linear-gradient(135deg, #a8b59c 0%, #9ca892 100%);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            min-height: 44px;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(168, 181, 156, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #7d8471 0%, #6b7560 100%);
            color: white;
        }
        
        .btn-success:hover {
            box-shadow: 0 5px 15px rgba(125, 132, 113, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #c8a48a 0%, #b5936d 100%);
            color: white;
        }
        
        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(200, 164, 138, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #d4b5a0 0%, #c8a48a 100%);
            color: white;
        }
        
        .btn-warning:hover {
            box-shadow: 0 5px 15px rgba(212, 181, 160, 0.4);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #9ca892 0%, #8b9480 100%);
            color: white;
        }
        
        .btn-info:hover {
            box-shadow: 0 5px 15px rgba(156, 168, 146, 0.4);
        }
        
        .transaction-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            overflow-x: auto;
            display: block;
            white-space: nowrap;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
        }
        
        .transaction-table thead, .transaction-table tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }
        
        .transaction-table th, .transaction-table td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid #d4b5a0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .transaction-table th {
            background: linear-gradient(135deg, #f5f2f0 0%, #e8e4e0 100%);
            font-weight: bold;
            position: sticky;
            top: 0;
            color: #8b7a6b;
        }
        
        .income {
            color: #7d8471;
            font-weight: bold;
        }
        
        .expense {
            color: #c8a48a;
            font-weight: bold;
        }
        
        .pending {
            background: linear-gradient(135deg, #f5f2f0 0%, #e8e4e0 100%);
            border-left: 4px solid #d4b5a0;
            border-radius: 10px;
        }
        
        .completed {
            background: linear-gradient(135deg, #d4d8ce 0%, #c8ccc2 100%);
            border-left: 4px solid #9ca892;
            border-radius: 10px;
        }
        
        .receipt-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .receipt-item {
            border: 2px solid #d4b5a0;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .receipt-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(212, 181, 160, 0.3);
        }
        
        .receipt-item img {
            width: 100%;
            max-width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid #d4b5a0;
        }
        
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #c8a48a 0%, #b5936d 100%);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .delete-btn:hover {
            background: linear-gradient(135deg, #b5936d 0%, #a68b7a 100%);
            transform: scale(1.1);
        }
        
        .table-delete-btn {
            background: linear-gradient(135deg, #c8a48a 0%, #b5936d 100%);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .table-delete-btn:hover {
            background: linear-gradient(135deg, #b5936d 0%, #a68b7a 100%);
            transform: scale(1.05);
        }
        
        .report-section {
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, #f5f2f0 0%, #e8e4e0 100%);
            border-radius: 15px;
            border: 2px solid rgba(212, 181, 160, 0.3);
        }
        
        .three-column {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
        }
        
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .request-card {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #d4b5a0;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(212, 181, 160, 0.2);
            transition: all 0.3s ease;
        }
        
        .request-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(212, 181, 160, 0.3);
        }
        
        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .status-badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            background: linear-gradient(135deg, #d4b5a0 0%, #c8a48a 100%);
            color: white;
        }
        
        .status-completed {
            background: linear-gradient(135deg, #9ca892 0%, #8b9480 100%);
            color: white;
        }
        
        .alert {
            padding: 20px;
            margin: 20px 0;
            border-radius: 15px;
            border-left: 4px solid;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #f5f2f0 0%, #e8e4e0 100%);
            border-color: #d4b5a0;
            color: #8b7a6b;
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #c8a48a 0%, #b5936d 100%);
            color: white;
        }
        
        .btn-reset:hover {
            background: linear-gradient(135deg, #b5936d 0%, #a68b7a 100%);
            box-shadow: 0 5px 15px rgba(200, 164, 138, 0.4);
        }
        
        .settings-form {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #d4b5a0;
            margin-bottom: 20px;
        }
            color: #2d5a41;
            font-weight: bold;
        }
        
        .expense {
            color: #8b4242;
            font-weight: bold;
        }
        
        .pending {
            background: linear-gradient(135deg, #ffffb1 0%, #fff5ee 100%);
            border-left: 4px solid #ffd1a9;
            border-radius: 10px;
        }
        
        .completed {
            background: linear-gradient(135deg, #b5ead7 0%, #a8e6cf 100%);
            border-left: 4px solid #88d8c0;
            border-radius: 10px;
        }
        
        .receipt-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .receipt-item {
            border: 2px solid #ffd1dc;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .receipt-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 209, 220, 0.3);
        }
        
        .receipt-item img {
            width: 100%;
            max-width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid #ffd1dc;
        }
        
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ffb7b2 0%, #ffd1dc 100%);
            color: #8b4242;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .delete-btn:hover {
            background: linear-gradient(135deg, #ff9aa2 0%, #ffb7b2 100%);
            transform: scale(1.1);
        }
        
        .table-delete-btn {
            background: linear-gradient(135deg, #ffb7b2 0%, #ffd1dc 100%);
            color: #8b4242;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
        }
        
        .btn-reset:hover {
            background: linear-gradient(135deg, #ff5252 0%, #ff6b6b 100%);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .settings-form {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #ffd1dc;
            margin-bottom: 20px;
        }
        
        .report-section {
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, #f0f8ff 0%, #ffeef4 100%);
            border-radius: 15px;
            border: 2px solid rgba(255, 209, 220, 0.3);
        }
        
        .three-column {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
        }
        
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .request-card {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #ffd1dc;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(255, 209, 220, 0.2);
            transition: all 0.3s ease;
        }
        
        .request-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 209, 220, 0.3);
        }
        
        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .status-badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            background: linear-gradient(135deg, #ffd1a9 0%, #ffffb1 100%);
            color: #8b6914;
        }
        
        .status-completed {
            background: linear-gradient(135deg, #b5ead7 0%, #a8e6cf 100%);
            color: #2d5a41;
        }
        
        .alert {
            padding: 20px;
            margin: 20px 0;
            border-radius: 15px;
            border-left: 4px solid;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #ffffb1 0%, #fff5ee 100%);
            border-color: #ffd1a9;
            color: #8b6914;
        }
        
        @media (max-width: 768px) {
            .three-column, .two-column {
                grid-template-columns: 1fr;
            }
            
            .balance-summary {
                grid-template-columns: 1fr;
            }
            
            .request-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .transaction-table {
                font-size: 14px;
            }
            
            nav {
                padding: 10px;
            }
            
            nav button {
                padding: 12px 15px;
                margin: 2px;
                font-size: 13px;
            }
            
            .logout-btn {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- 로그인 화면 -->
    <div id="loginScreen" class="login-container">
        <div class="login-form">
            <h1>🏛️ 파주직장1여 다락방 회계장부</h1>
            <p>개인정보 보호를 위해 비밀번호를 입력해주세요</p>
            <input type="password" id="passwordInput" placeholder="비밀번호를 입력하세요" onkeypress="checkEnterKey(event)">
            <button onclick="login()">로그인</button>
            <p style="font-size: 12px; color: #999; margin-top: 20px;">
                기본 비밀번호: 1234 (설정에서 변경 가능)
            </p>
        </div>
    </div>
    
    <!-- 메인 애플리케이션 -->
    <div id="mainApp" class="main-app">
        <header>
            <button class="logout-btn" onclick="logout()">로그아웃</button>
            <h1>🏛️ 파주직장1여 다락방 회계장부</h1>
            <p>투명하고 체계적인 회계 관리</p>
        </header>
        
        <nav>
            <button onclick="showSection('setup')" class="active">초기설정</button>
            <button onclick="showSection('dashboard')">대시보드</button>
            <button onclick="showSection('transaction')">입출금등록</button>
            <button onclick="showSection('request')">지출요청</button>
            <button onclick="showSection('pending')">대기중요청</button>
            <button onclick="showSection('history')">거래내역</button>
            <button onclick="showSection('receipts')">영수증관리</button>
            <button onclick="showSection('report')">회계보고서</button>
        </nav>
        
        <div class="container">
            <!-- 초기 설정 섹션 -->
            <div id="setup" class="section active setup-section">
                <h2>⚙️ 초기 설정</h2>
                <div class="alert alert-warning">
                    <strong>중요!</strong> 회계 시작 전에 기준 날짜와 이월 잔고를 설정해주세요.
                </div>
                
                <div id="setupForm" class="settings-form">
                    <div class="form-group">
                        <label>회계 기준 날짜</label>
                        <input type="date" id="baseDate" value="">
                    </div>
                    
                    <div class="form-group">
                        <label>이월 잔고 (원)</label>
                        <input type="number" id="carryOverInput" placeholder="예: 50000" value="50000">
                    </div>
                    
                    <div class="form-group">
                        <label>담당자 이름</label>
                        <input type="text" id="managerName" placeholder="회계 담당자 이름을 입력하세요">
                    </div>
                    
                    <div class="form-group">
                        <label>비밀번호 변경 (선택사항)</label>
                        <input type="password" id="newPassword" placeholder="새 비밀번호 (기본값: 1234)">
                    </div>
                    
                    <button onclick="saveInitialSettings()" class="btn btn-success">설정 저장</button>
                </div>
                
                <div id="currentSettings" style="margin-top: 30px; padding: 20px; background: rgba(255, 255, 255, 0.8); border-radius: 15px; display: none;">
                    <h3>현재 설정</h3>
                    <p><strong>기준 날짜:</strong> <span id="currentBaseDate">-</span></p>
                    <p><strong>이월 잔고:</strong> <span id="currentCarryOver">-</span></p>
                    <p><strong>담당자:</strong> <span id="currentManager">-</span></p>
                    
                    <div class="alert alert-warning" style="margin-top: 20px;">
                        <strong>⚠️ 주의!</strong> 설정을 초기화하면 모든 거래 내역, 영수증, 지출 요청이 삭제됩니다.
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="editSettings()" class="btn btn-warning" style="flex: 1;">설정 수정</button>
                        <button onclick="resetAllData()" class="btn btn-danger" style="flex: 1;">전체 초기화</button>
                    </div>
                </div>
            </div>
            
            <!-- 대시보드 섹션 -->
            <div id="dashboard" class="section">
                <h2>📊 회계 현황 대시보드</h2>
                <div class="balance-summary">
                    <div class="balance-card">
                        <h3>이월 잔고</h3>
                        <div class="amount" id="carryOverBalance">0원</div>
                    </div>
                    <div class="balance-card">
                        <h3>총 입금</h3>
                        <div class="amount" id="totalIncome">0원</div>
                    </div>
                    <div class="balance-card">
                        <h3>총 출금</h3>
                        <div class="amount" id="totalExpense">0원</div>
                    </div>
                    <div class="balance-card">
                        <h3>현재 잔액</h3>
                        <div class="amount" id="currentBalance">0원</div>
                    </div>
                </div>
                
                <div class="two-column">
                    <div class="report-section">
                        <h3>📈 이번 달 요약</h3>
                        <p><strong>거래 건수:</strong> <span id="transactionCount">0건</span></p>
                        <p><strong>최근 거래일:</strong> <span id="lastTransactionDate">-</span></p>
                        <p><strong>대기중 지출 요청:</strong> <span id="pendingRequestCount">0건</span></p>
                    </div>
                    
                    <div class="report-section">
                        <h3>⏰ 빠른 작업</h3>
                        <button onclick="showSection('transaction')" class="btn" style="margin-bottom: 10px;">💰 입출금 등록</button>
                        <button onclick="showSection('request')" class="btn btn-warning" style="margin-bottom: 10px;">📝 지출 요청</button>
                        <button onclick="showSection('pending')" class="btn btn-info">⏳ 대기중 요청 확인</button>
                    </div>
                </div>
            </div>
            
            <!-- 입출금 등록 섹션 -->
            <div id="transaction" class="section">
                <h2>💰 입출금 등록</h2>
                
                <div class="two-column">
                    <div>
                        <h3>✅ 입금 등록</h3>
                        <div class="form-group">
                            <label>입금액</label>
                            <input type="number" id="incomeAmount" placeholder="금액을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label>입금 내역</label>
                            <select id="incomeCategory">
                                <option value="헌금">헌금</option>
                                <option value="모임비">모임비</option>
                                <option value="후원금">후원금</option>
                                <option value="이자수입">이자수입</option>
                                <option value="기타수입">기타수입</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>상세 내용</label>
                            <input type="text" id="incomeDescription" placeholder="상세 내용을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label>입금자 이름</label>
                            <input type="text" id="incomePersonName" placeholder="입금자 이름">
                        </div>
                        <button onclick="addTransaction('income')" class="btn btn-success">입금 등록</button>
                    </div>
                    
                    <div>
                        <h3>❌ 출금 등록</h3>
                        <div class="form-group">
                            <label>출금액</label>
                            <input type="number" id="expenseAmount" placeholder="금액을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label>출금 내역</label>
                            <select id="expenseCategory">
                                <option value="다락방 헌금">다락방 헌금</option>
                                <option value="식사비">식사비</option>
                                <option value="열린 다락방 모임비">열린 다락방 모임비</option>
                                <option value="선물비">선물비</option>
                                <option value="행사비">행사비</option>
                                <option value="기타지출">기타지출</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>상세 내용</label>
                            <input type="text" id="expenseDescription" placeholder="상세 내용을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label>지출자 이름</label>
                            <input type="text" id="expensePersonName" placeholder="지출자 이름">
                        </div>
                        <div class="form-group">
                            <label>영수증 업로드</label>
                            <input type="file" id="receiptFile" accept="image/*">
                        </div>
                        <button onclick="addTransaction('expense')" class="btn btn-danger">출금 등록</button>
                    </div>
                </div>
            </div>
            
            <!-- 지출 요청 섹션 -->
            <div id="request" class="section">
                <h2>📝 지출 요청</h2>
                <p style="color: #666; margin-bottom: 30px;">다른 사람이 대신 지출할 때 미리 요청을 등록하세요. 나중에 영수증을 받아 처리할 수 있습니다.</p>
                
                <div class="form-group">
                    <label>요청자 이름</label>
                    <input type="text" id="requestPersonName" placeholder="지출을 요청하는 사람 이름">
                </div>
                
                <div class="form-group">
                    <label>예상 지출액</label>
                    <input type="number" id="requestAmount" placeholder="예상 지출 금액">
                </div>
                
                <div class="form-group">
                    <label>지출 카테고리</label>
                    <select id="requestCategory">
                        <option value="다락방 헌금">다락방 헌금</option>
                        <option value="식사비">식사비</option>
                        <option value="열린 다락방 모임비">열린 다락방 모임비</option>
                        <option value="선물비">선물비</option>
                        <option value="행사비">행사비</option>
                        <option value="기타지출">기타지출</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>지출 목적</label>
                    <textarea id="requestPurpose" rows="3" placeholder="무엇을 위한 지출인지 자세히 적어주세요"></textarea>
                </div>
                
                <div class="form-group">
                    <label>연락처</label>
                    <input type="text" id="requestContact" placeholder="요청자 연락처 (전화번호 또는 카카오톡 ID)">
                </div>
                
                <div class="form-group">
                    <label>송금 계좌 정보</label>
                    <input type="text" id="requestAccount" placeholder="은행명 계좌번호 예금주명">
                </div>
                
                <div class="form-group">
                    <label>영수증 미리 업로드 (선택사항)</label>
                    <input type="file" id="requestReceiptFile" accept="image/*">
                    <small style="color: #666; font-size: 14px;">지출 후 영수증이 있다면 미리 업로드하세요</small>
                </div>
                
                <button onclick="submitExpenseRequest()" class="btn btn-warning">지출 요청 등록</button>
            </div>
            
            <!-- 대기중 요청 섹션 -->
            <div id="pending" class="section">
                <h2>⏳ 대기중인 지출 요청</h2>
                <p style="color: #666; margin-bottom: 30px;">영수증 업로드 대기중이거나 송금 대기중인 요청들입니다.</p>
                
                <div id="pendingRequests">
                    <div style="text-align: center; color: #666; padding: 40px;">
                        대기중인 지출 요청이 없습니다.
                    </div>
                </div>
            </div>
            
            <!-- 거래 내역 섹션 -->
            <div id="history" class="section">
                <h2>📋 거래 내역</h2>
                <div style="overflow-x: auto;">
                    <table class="transaction-table">
                        <thead>
                            <tr>
                                <th>날짜</th>
                                <th>구분</th>
                                <th>카테고리</th>
                                <th>내용</th>
                                <th>담당자</th>
                                <th>금액</th>
                                <th>잔액</th>
                                <th>영수증</th>
                                <th>삭제</th>
                            </tr>
                        </thead>
                        <tbody id="transactionHistory">
                            <tr>
                                <td colspan="9" style="text-align: center; color: #666;">등록된 거래 내역이 없습니다.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 영수증 관리 섹션 -->
            <div id="receipts" class="section">
                <h2>🧾 영수증 관리</h2>
                <p>업로드된 영수증들을 한눈에 확인할 수 있습니다. 잘못 업로드된 영수증은 삭제할 수 있습니다.</p>
                <div id="receiptGallery" class="receipt-gallery">
                    <div style="grid-column: 1/-1; text-align: center; color: #666; padding: 40px;">
                        아직 업로드된 영수증이 없습니다.
                    </div>
                </div>
            </div>
            
            <!-- 회계 보고서 섹션 -->
            <div id="report" class="section">
                <h2>📊 회계 결산 보고서</h2>
                
                <div class="report-section">
                    <h3>📅 회계 기간</h3>
                    <p><strong>기준일:</strong> <span id="reportBaseDate">-</span></p>
                    <p><strong>보고서 작성일:</strong> <span id="reportDate">-</span></p>
                    <p><strong>담당자:</strong> <span id="reportManager">-</span></p>
                </div>
                
                <div class="two-column">
                    <div class="report-section">
                        <h3>💼 수입 내역 요약</h3>
                        <div id="incomeReport">
                            <p>헌금: 0원</p>
                            <p>모임비: 0원</p>
                            <p>후원금: 0원</p>
                            <p>이자수입: 0원</p>
                            <p>기타수입: 0원</p>
                            <hr>
                            <p><strong>총 수입: <span id="reportTotalIncome">0원</span></strong></p>
                        </div>
                    </div>
                    
                    <div class="report-section">
                        <h3>💸 지출 내역 요약</h3>
                        <div id="expenseReport">
                            <p>다락방 헌금: 0원</p>
                            <p>식사비: 0원</p>
                            <p>열린 다락방 모임비: 0원</p>
                            <p>선물비: 0원</p>
                            <p>행사비: 0원</p>
                            <p>기타지출: 0원</p>
                            <hr>
                            <p><strong>총 지출: <span id="reportTotalExpense">0원</span></strong></p>
                        </div>
                    </div>
                </div>
                
                <div class="report-section">
                    <h3>📈 최종 결산</h3>
                    <p><strong>이월 잔고:</strong> <span id="reportCarryOver">0원</span></p>
                    <p><strong>당기 수입:</strong> <span id="reportCurrentIncome">0원</span></p>
                    <p><strong>당기 지출:</strong> <span id="reportCurrentExpense">0원</span></p>
                    <hr>
                    <p style="font-size: 1.2em;"><strong>기말 잔액: <span id="reportFinalBalance">0원</span></strong></p>
                    <p><strong>총 거래 건수:</strong> <span id="reportTransactionCount">0건</span></p>
                    <p><strong>대기중 요청:</strong> <span id="reportPendingCount">0건</span></p>
                </div>
                
                <button onclick="generateReport()" class="btn">📄 보고서 새로고침</button>
            </div>
        </div>
    </div>
    
    <script>
        // 전역 변수
        let transactions = [];
        let receipts = [];
        let expenseRequests = [];
        let currentPassword = '1234';
        let settings = {
            baseDate: '',
            carryOverBalance: 0,
            managerName: '',
            isSetup: false
        };
        
        // 로그인 관련 함수
        function checkEnterKey(event) {
            if (event.key === 'Enter') {
                login();
            }
        }
        
        function login() {
            const password = document.getElementById('passwordInput').value;
            if (password === currentPassword) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                loadSettings();
                setTodayAsDefault();
                updateAllDisplays();
            } else {
                alert('비밀번호가 올바르지 않습니다.');
                document.getElementById('passwordInput').value = '';
            }
        }
        
        function logout() {
            if (confirm('로그아웃 하시겠습니까?')) {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('passwordInput').value = '';
            }
        }
        
        // 페이지 로드시 설정 확인
        window.onload = function() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        };
        
        // 오늘 날짜를 기본값으로 설정
        function setTodayAsDefault() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('baseDate').value = today;
        }
        
        // 설정 저장
        function saveInitialSettings() {
            const baseDate = document.getElementById('baseDate').value;
            const carryOver = parseInt(document.getElementById('carryOverInput').value) || 0;
            const manager = document.getElementById('managerName').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            
            if (!baseDate) {
                alert('기준 날짜를 선택해주세요.');
                return;
            }
            
            if (!manager) {
                alert('담당자 이름을 입력해주세요.');
                return;
            }
            
            settings = {
                baseDate: baseDate,
                carryOverBalance: carryOver,
                managerName: manager,
                isSetup: true
            };
            
            if (newPassword) {
                currentPassword = newPassword;
                alert('비밀번호가 변경되었습니다.');
            }
            
            updateSettingsDisplay();
            updateAllDisplays();
            
            // 설정 폼 숨기고 현재 설정 표시
            document.getElementById('setupForm').style.display = 'none';
            document.getElementById('currentSettings').style.display = 'block';
            
            alert('초기 설정이 저장되었습니다!');
            
            // 입력 필드 초기화
            document.getElementById('newPassword').value = '';
        }
        
        // 설정 수정
        function editSettings() {
            if (confirm('설정을 수정하시겠습니까?\n\n기존 설정값이 입력 폼에 다시 표시됩니다.')) {
                // 현재 설정값을 입력 폼에 다시 표시
                document.getElementById('baseDate').value = settings.baseDate;
                document.getElementById('carryOverInput').value = settings.carryOverBalance;
                document.getElementById('managerName').value = settings.managerName;
                
                // 폼 다시 표시
                document.getElementById('setupForm').style.display = 'block';
                document.getElementById('currentSettings').style.display = 'none';
            }
        }
        
        // 전체 데이터 초기화
        function resetAllData() {
            const confirmText = `정말로 모든 데이터를 초기화하시겠습니까?

삭제될 데이터:
• 초기 설정 (기준날짜, 이월잔고, 담당자)
• 모든 거래 내역 (${transactions.length}건)
• 모든 영수증 (${receipts.length}개)
• 모든 지출 요청 (${expenseRequests.length}건)
• 비밀번호는 기본값(1234)으로 초기화

⚠️ 이 작업은 되돌릴 수 없습니다!`;

            if (confirm(confirmText)) {
                const finalConfirm = prompt('정말로 초기화하려면 "초기화"라고 입력하세요:', '');
                
                if (finalConfirm === '초기화') {
                    // 모든 데이터 초기화
                    transactions = [];
                    receipts = [];
                    expenseRequests = [];
                    currentPassword = '1234';
                    settings = {
                        baseDate: '',
                        carryOverBalance: 0,
                        managerName: '',
                        isSetup: false
                    };
                    
                    // 폼 초기화
                    document.getElementById('baseDate').value = '';
                    document.getElementById('carryOverInput').value = '50000';
                    document.getElementById('managerName').value = '';
                    document.getElementById('newPassword').value = '';
                    
                    // 화면 초기화
                    document.getElementById('setupForm').style.display = 'block';
                    document.getElementById('currentSettings').style.display = 'none';
                    
                    // 오늘 날짜 다시 설정
                    setTodayAsDefault();
                    updateAllDisplays();
                    
                    alert('모든 데이터가 초기화되었습니다.\n비밀번호도 기본값(1234)으로 초기화되었습니다.');
                } else {
                    alert('취소되었습니다.');
                }
            }
        }
        
        // 설정 표시 업데이트
        function updateSettingsDisplay() {
            if (settings.isSetup) {
                document.getElementById('setupForm').style.display = 'none';
                document.getElementById('currentSettings').style.display = 'block';
                document.getElementById('currentBaseDate').textContent = settings.baseDate;
                document.getElementById('currentCarryOver').textContent = settings.carryOverBalance.toLocaleString() + '원';
                document.getElementById('currentManager').textContent = settings.managerName;
            } else {
                document.getElementById('setupForm').style.display = 'block';
                document.getElementById('currentSettings').style.display = 'none';
            }
        }
        
        // 설정 로드
        function loadSettings() {
            updateSettingsDisplay();
        }
        
        // 페이지 섹션 전환
        function showSection(sectionName) {
            if (!settings.isSetup && sectionName !== 'setup') {
                alert('먼저 초기 설정을 완료해주세요.');
                return;
            }
            
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.remove('active'));
            
            const buttons = document.querySelectorAll('nav button');
            buttons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // 거래 등록
        function addTransaction(type) {
            if (!settings.isSetup) {
                alert('먼저 초기 설정을 완료해주세요.');
                return;
            }
            
            let amount, category, description, personName;
            
            if (type === 'income') {
                amount = parseInt(document.getElementById('incomeAmount').value);
                category = document.getElementById('incomeCategory').value;
                description = document.getElementById('incomeDescription').value;
                personName = document.getElementById('incomePersonName').value.trim();
                
                if (!amount || amount <= 0) {
                    alert('올바른 입금액을 입력해주세요.');
                    return;
                }
                
                // 입력 필드 초기화
                document.getElementById('incomeAmount').value = '';
                document.getElementById('incomeDescription').value = '';
                document.getElementById('incomePersonName').value = '';
                
            } else {
                amount = parseInt(document.getElementById('expenseAmount').value);
                category = document.getElementById('expenseCategory').value;
                description = document.getElementById('expenseDescription').value;
                personName = document.getElementById('expensePersonName').value.trim();
                const receiptFile = document.getElementById('receiptFile').files[0];
                
                if (!amount || amount <= 0) {
                    alert('올바른 출금액을 입력해주세요.');
                    return;
                }
                
                // 영수증 처리
                if (receiptFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        receipts.push({
                            id: Date.now(),
                            category: category,
                            description: description,
                            amount: amount,
                            image: e.target.result,
                            date: new Date().toLocaleDateString('ko-KR'),
                            personName: personName
                        });
                        updateReceiptGallery();
                    };
                    reader.readAsDataURL(receiptFile);
                }
                
                // 입력 필드 초기화
                document.getElementById('expenseAmount').value = '';
                document.getElementById('expenseDescription').value = '';
                document.getElementById('expensePersonName').value = '';
                document.getElementById('receiptFile').value = '';
            }
            
            // 거래 내역 추가
            const currentBalance = getCurrentBalance();
            const newBalance = type === 'income' ? currentBalance + amount : currentBalance - amount;
            
            const transaction = {
                id: Date.now(),
                date: new Date().toLocaleDateString('ko-KR'),
                type: type,
                category: category,
                description: description,
                amount: amount,
                balance: newBalance,
                personName: personName || '미입력'
            };
            
            transactions.push(transaction);
            updateAllDisplays();
            
            alert(type === 'income' ? '입금이 등록되었습니다!' : '출금이 등록되었습니다!');
        }
        
        // 지출 요청 등록
        function submitExpenseRequest() {
            const personName = document.getElementById('requestPersonName').value.trim();
            const amount = parseInt(document.getElementById('requestAmount').value);
            const category = document.getElementById('requestCategory').value;
            const purpose = document.getElementById('requestPurpose').value.trim();
            const contact = document.getElementById('requestContact').value.trim();
            const account = document.getElementById('requestAccount').value.trim();
            const receiptFile = document.getElementById('requestReceiptFile').files[0];
            
            if (!personName || !amount || !purpose || !contact || !account) {
                alert('모든 필수 항목을 입력해주세요.');
                return;
            }
            
            if (amount <= 0) {
                alert('올바른 금액을 입력해주세요.');
                return;
            }
            
            const request = {
                id: Date.now(),
                date: new Date().toLocaleDateString('ko-KR'),
                personName: personName,
                amount: amount,
                category: category,
                purpose: purpose,
                contact: contact,
                account: account,
                status: 'pending',
                hasReceipt: false,
                receiptImage: null
            };
            
            // 영수증 처리
            if (receiptFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    request.hasReceipt = true;
                    request.receiptImage = e.target.result;
                    
                    receipts.push({
                        id: Date.now(),
                        category: category,
                        description: purpose,
                        amount: amount,
                        image: e.target.result,
                        date: new Date().toLocaleDateString('ko-KR'),
                        personName: personName,
                        isRequest: true
                    });
                    updateReceiptGallery();
                };
                reader.readAsDataURL(receiptFile);
            }
            
            expenseRequests.push(request);
            updatePendingRequests();
            updateAllDisplays();
            
            // 입력 필드 초기화
            document.getElementById('requestPersonName').value = '';
            document.getElementById('requestAmount').value = '';
            document.getElementById('requestPurpose').value = '';
            document.getElementById('requestContact').value = '';
            document.getElementById('requestAccount').value = '';
            document.getElementById('requestReceiptFile').value = '';
            
            alert('지출 요청이 등록되었습니다!');
        }
        
        // 현재 잔액 계산
        function getCurrentBalance() {
            let balance = settings.carryOverBalance;
            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    balance += transaction.amount;
                } else {
                    balance -= transaction.amount;
                }
            });
            return balance;
        }
        
        // 모든 화면 업데이트
        function updateAllDisplays() {
            updateDashboard();
            updateTransactionHistory();
            updateReceiptGallery();
            updatePendingRequests();
        }
        
        // 대시보드 업데이트
        function updateDashboard() {
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const currentBalance = getCurrentBalance();
            
            document.getElementById('carryOverBalance').textContent = settings.carryOverBalance.toLocaleString() + '원';
            document.getElementById('totalIncome').textContent = totalIncome.toLocaleString() + '원';
            document.getElementById('totalExpense').textContent = totalExpense.toLocaleString() + '원';
            document.getElementById('currentBalance').textContent = currentBalance.toLocaleString() + '원';
            document.getElementById('transactionCount').textContent = transactions.length + '건';
            document.getElementById('pendingRequestCount').textContent = expenseRequests.filter(r => r.status === 'pending').length + '건';
            
            if (transactions.length > 0) {
                document.getElementById('lastTransactionDate').textContent = transactions[transactions.length - 1].date;
            }
        }
        
        // 거래 내역 테이블 업데이트
        function updateTransactionHistory() {
            const tbody = document.getElementById('transactionHistory');
            
            if (transactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">등록된 거래 내역이 없습니다.</td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            
            // 최신 거래부터 표시
            transactions.slice().reverse().forEach((transaction, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${transaction.date}</td>
                    <td>${transaction.type === 'income' ? '입금' : '출금'}</td>
                    <td>${transaction.category}</td>
                    <td>${transaction.description}</td>
                    <td>${transaction.personName}</td>
                    <td class="${transaction.type}">${transaction.type === 'income' ? '+' : '-'}${transaction.amount.toLocaleString()}원</td>
                    <td>${transaction.balance.toLocaleString()}원</td>
                    <td>${transaction.type === 'expense' && receipts.find(r => r.date === transaction.date && r.amount === transaction.amount) ? '📎' : '-'}</td>
                    <td><button onclick="deleteTransaction(${transaction.id})" class="table-delete-btn">🗑️</button></td>
                `;
            });
        }
        
        // 영수증 갤러리 업데이트
        function updateReceiptGallery() {
            const gallery = document.getElementById('receiptGallery');
            
            if (receipts.length === 0) {
                gallery.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #666; padding: 40px;">아직 업로드된 영수증이 없습니다.</div>';
                return;
            }
            
            gallery.innerHTML = '';
            
            receipts.forEach(receipt => {
                const receiptDiv = document.createElement('div');
                receiptDiv.className = 'receipt-item';
                receiptDiv.innerHTML = `
                    <button onclick="deleteReceipt(${receipt.id})" class="delete-btn">🗑️</button>
                    <img src="${receipt.image}" alt="영수증">
                    <p><strong>${receipt.category}</strong></p>
                    <p>${receipt.description}</p>
                    <p><strong>${receipt.personName}</strong></p>
                    <p class="expense">${receipt.amount.toLocaleString()}원</p>
                    <p style="font-size: 0.9em; color: #666;">${receipt.date}</p>
                    ${receipt.isRequest ? '<p style="font-size: 0.8em; color: #ffa500;">지출요청</p>' : ''}
                `;
                gallery.appendChild(receiptDiv);
            });
        }
        
        // 대기중 요청 업데이트
        function updatePendingRequests() {
            const container = document.getElementById('pendingRequests');
            const pendingRequests = expenseRequests.filter(r => r.status === 'pending');
            
            if (pendingRequests.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">대기중인 지출 요청이 없습니다.</div>';
                return;
            }
            
            container.innerHTML = '';
            
            pendingRequests.forEach(request => {
                const requestDiv = document.createElement('div');
                requestDiv.className = 'request-card';
                requestDiv.innerHTML = `
                    <div class="request-header">
                        <h4>${request.personName} - ${request.category}</h4>
                        <span class="status-badge status-pending">대기중</span>
                    </div>
                    <p><strong>금액:</strong> ${request.amount.toLocaleString()}원</p>
                    <p><strong>목적:</strong> ${request.purpose}</p>
                    <p><strong>연락처:</strong> ${request.contact}</p>
                    <p><strong>계좌:</strong> ${request.account}</p>
                    <p><strong>요청일:</strong> ${request.date}</p>
                    <p><strong>영수증:</strong> ${request.hasReceipt ? '✅ 업로드 완료' : '❌ 미업로드'}</p>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="completeRequest(${request.id})" class="btn btn-success" style="flex: 1;">처리 완료</button>
                        <button onclick="deleteRequest(${request.id})" class="btn btn-danger" style="flex: 1;">요청 삭제</button>
                    </div>
                `;
                container.appendChild(requestDiv);
            });
        }
        
        // 요청 처리 완료
        function completeRequest(requestId) {
            const request = expenseRequests.find(r => r.id === requestId);
            if (request) {
                if (confirm(`${request.personName}님의 지출 요청(${request.amount.toLocaleString()}원)을 처리 완료하시겠습니까?`)) {
                    request.status = 'completed';
                    
                    // 거래 내역에 추가
                    const transaction = {
                        id: Date.now(),
                        date: new Date().toLocaleDateString('ko-KR'),
                        type: 'expense',
                        category: request.category,
                        description: request.purpose,
                        amount: request.amount,
                        balance: getCurrentBalance() - request.amount,
                        personName: request.personName
                    };
                    
                    transactions.push(transaction);
                    updateAllDisplays();
                    
                    alert('지출 요청이 처리 완료되었습니다!');
                }
            }
        }
        
        // 거래 삭제
        function deleteTransaction(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (transaction) {
                if (confirm(`${transaction.date} ${transaction.category} 거래(${transaction.amount.toLocaleString()}원)를 삭제하시겠습니까?\n\n⚠️ 주의: 이후 거래들의 잔액이 모두 재계산됩니다.`)) {
                    // 거래 삭제
                    const index = transactions.findIndex(t => t.id === transactionId);
                    transactions.splice(index, 1);
                    
                    // 관련 영수증도 삭제
                    receipts = receipts.filter(r => !(r.date === transaction.date && r.amount === transaction.amount && r.personName === transaction.personName));
                    
                    // 삭제된 거래 이후의 모든 거래 잔액 재계산
                    recalculateBalances();
                    updateAllDisplays();
                    
                    alert('거래가 삭제되었습니다.');
                }
            }
        }
        
        // 영수증 삭제
        function deleteReceipt(receiptId) {
            const receipt = receipts.find(r => r.id === receiptId);
            if (receipt) {
                if (confirm(`${receipt.date} ${receipt.category} 영수증을 삭제하시겠습니까?`)) {
                    receipts = receipts.filter(r => r.id !== receiptId);
                    updateReceiptGallery();
                    alert('영수증이 삭제되었습니다.');
                }
            }
        }
        
        // 지출 요청 삭제
        function deleteRequest(requestId) {
            const request = expenseRequests.find(r => r.id === requestId);
            if (request) {
                if (confirm(`${request.personName}님의 지출 요청(${request.amount.toLocaleString()}원)을 삭제하시겠습니까?`)) {
                    // 요청 삭제
                    expenseRequests = expenseRequests.filter(r => r.id !== requestId);
                    
                    // 관련 영수증도 삭제 (요청과 함께 업로드된 것)
                    if (request.hasReceipt) {
                        receipts = receipts.filter(r => !(r.date === request.date && r.amount === request.amount && r.personName === request.personName && r.isRequest));
                    }
                    
                    updateAllDisplays();
                    alert('지출 요청이 삭제되었습니다.');
                }
            }
        }
        
        // 잔액 재계산 (거래 삭제 후)
        function recalculateBalances() {
            let currentBalance = settings.carryOverBalance;
            
            // 날짜순으로 정렬하여 순차적으로 잔액 계산
            transactions.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    currentBalance += transaction.amount;
                } else {
                    currentBalance -= transaction.amount;
                }
                transaction.balance = currentBalance;
            });
        }
        
        // 회계 보고서 생성
        function generateReport() {
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const finalBalance = getCurrentBalance();
            
            // 카테고리별 수입 집계
            const incomeByCategory = {
                '헌금': 0,
                '모임비': 0,
                '후원금': 0,
                '이자수입': 0,
                '기타수입': 0
            };
            
            // 카테고리별 지출 집계
            const expenseByCategory = {
                '다락방 헌금': 0,
                '식사비': 0,
                '열린 다락방 모임비': 0,
                '선물비': 0,
                '행사비': 0,
                '기타지출': 0
            };
            
            // 거래 내역을 순회하며 카테고리별 금액 계산
            transactions.forEach(transaction => {
                if (transaction.type === 'income' && incomeByCategory.hasOwnProperty(transaction.category)) {
                    incomeByCategory[transaction.category] += transaction.amount;
                } else if (transaction.type === 'expense' && expenseByCategory.hasOwnProperty(transaction.category)) {
                    expenseByCategory[transaction.category] += transaction.amount;
                }
            });
            
            // 보고서 날짜 정보 업데이트
            document.getElementById('reportBaseDate').textContent = settings.baseDate || '-';
            document.getElementById('reportDate').textContent = new Date().toLocaleDateString('ko-KR');
            document.getElementById('reportManager').textContent = settings.managerName || '-';
            
            // 수입 내역 요약 업데이트
            const incomeReportDiv = document.getElementById('incomeReport');
            incomeReportDiv.innerHTML = `
                <p>헌금: ${incomeByCategory['헌금'].toLocaleString()}원</p>
                <p>모임비: ${incomeByCategory['모임비'].toLocaleString()}원</p>
                <p>후원금: ${incomeByCategory['후원금'].toLocaleString()}원</p>
                <p>이자수입: ${incomeByCategory['이자수입'].toLocaleString()}원</p>
                <p>기타수입: ${incomeByCategory['기타수입'].toLocaleString()}원</p>
                <hr style="margin: 15px 0; border: none; border-top: 2px solid #d4b5a0;">
                <p><strong>총 수입: ${totalIncome.toLocaleString()}원</strong></p>
            `;
            
            // 지출 내역 요약 업데이트
            const expenseReportDiv = document.getElementById('expenseReport');
            expenseReportDiv.innerHTML = `
                <p>다락방 헌금: ${expenseByCategory['다락방 헌금'].toLocaleString()}원</p>
                <p>식사비: ${expenseByCategory['식사비'].toLocaleString()}원</p>
                <p>열린 다락방 모임비: ${expenseByCategory['열린 다락방 모임비'].toLocaleString()}원</p>
                <p>선물비: ${expenseByCategory['선물비'].toLocaleString()}원</p>
                <p>행사비: ${expenseByCategory['행사비'].toLocaleString()}원</p>
                <p>기타지출: ${expenseByCategory['기타지출'].toLocaleString()}원</p>
                <hr style="margin: 15px 0; border: none; border-top: 2px solid #d4b5a0;">
                <p><strong>총 지출: ${totalExpense.toLocaleString()}원</strong></p>
            `;
            
            // 최종 결산 정보 업데이트
            document.getElementById('reportCarryOver').textContent = settings.carryOverBalance.toLocaleString() + '원';
            document.getElementById('reportCurrentIncome').textContent = totalIncome.toLocaleString() + '원';
            document.getElementById('reportCurrentExpense').textContent = totalExpense.toLocaleString() + '원';
            document.getElementById('reportFinalBalance').textContent = finalBalance.toLocaleString() + '원';
            document.getElementById('reportTotalIncome').textContent = totalIncome.toLocaleString() + '원';
            document.getElementById('reportTotalExpense').textContent = totalExpense.toLocaleString() + '원';
            document.getElementById('reportTransactionCount').textContent = transactions.length + '건';
            document.getElementById('reportPendingCount').textContent = expenseRequests.filter(r => r.status === 'pending').length + '건';
            
            alert('보고서가 업데이트되었습니다!');
        }
    </script>
</body>
</html>
